<ng-container *ngIf="fieldConfig$ | async as fieldConfig">
  <ng-container *ngIf="fieldSetting$ | async as fieldSetting">
    <ng-container *ngIf="form" [formGroup]="form">
      <icc-form-field
        *ngIf="selectOptions$ | async as selectOptions"
        [ngStyle]="{ display: hidden ? 'none' : 'inherit' }"
        [iccLabelWidth]="fieldConfig.labelWidth"
        [iccFieldWidth]="fieldConfig.fieldWidth"
        [iccFormFieldControl]="field"
        [showFieldEditIndicator]="showFieldEditIndicator"
      >
        @if (fieldConfig.fieldLabel !== undefined) {
          <icc-label>{{ fieldConfig.fieldLabel | translate }}</icc-label>
        }
        <input
          iccInput
          #inputEl
          type="text"
          autocomplete="off"
          [readonly]="!!fieldConfig.selectOnly"
          [formControlName]="fieldName!"
          (isOverlayOpen)="overlayOpen($event)"
          (change)="onChange($event)"
          [iccAutocomplete]="autocomplete"
          [iccAutocompleteClose]="autocompleteClose"
          [iccAutocompleteClickOption]="clickedOption"
          [required]="required"
          placeholder="{{ fieldConfig.placeholder! | translate }}"
        />

        @if (fieldConfig.clearValue && hasValue) {
          <icc-icon icon="remove" iccSuffix (click)="clearSelected($event)"></icc-icon>
        }
        @if (!field.disabled) {
          <icc-icon icon="angle-down" iccSuffix [ngStyle]="{ display: isOverlayOpen ? 'none' : '' }"></icc-icon>
        }
        @if (isOverlayOpen) {
          <icc-icon icon="angle-up" iccSuffix (click)="closeOverlay()"></icc-icon>
        }
        <icc-autocomplete
          #autocomplete="iccAutocomplete"
          [multiSelection]="fieldConfig.multiSelection"
          [displayWith]="displayFn.bind(this)"
          [compareWith]="compareFn.bind(this)"
        >
          <ng-template iccAutocompleteContent>
            <icc-select-view
              [fieldConfig]="fieldConfig"
              [form]="form"
              [fieldName]="fieldName"
              [selectOptions]="selectOptions"
              [value]="value"
            >
            </icc-select-view>
          </ng-template>
        </icc-autocomplete>
        <!--

          <ng-template iccAutocompleteContent>
            <div *ngIf="hasHeader(fieldConfig)" class="icc-select-field-sticky-header">
              @if (fieldConfig.multiSelection && fieldConfig.checkAll) {
                <icc-option (click)="checkAll(selectOptions)">
                  <icc-checkbox [checked]="isAllChecked">{{ "ICC.UI.ACTIONS.CHECK_ALL" | translate }}</icc-checkbox>
                </icc-option>
              }
              @if (fieldConfig.multiSelection && fieldConfig.uncheckAll) {
                <icc-option (click)="checkAll([])">
                  <icc-checkbox [checked]="!hasValue">{{ "ICC.UI.ACTIONS.UNCHECK_ALL" | translate }}</icc-checkbox>
                </icc-option>
              }
              @if (fieldConfig.isEmpty) {
                <icc-option #refIsEmpty [value]="isEmptyValue" (click)="headerOptionClick(refIsEmpty)">
                  <icc-checkbox [checked]="refIsEmpty.selected">
                    {{ "ICC.UI.ACTIONS.IS_EMPTY" | translate }}
                  </icc-checkbox>
                </icc-option>
              }
              @if (fieldConfig.notEmpty) {
                <icc-option #refIsNotEmpty [value]="notEmptyValue" (click)="headerOptionClick(refIsNotEmpty)">
                  <icc-checkbox [checked]="refIsNotEmpty.selected">
                    {{ "ICC.UI.ACTIONS.NOT_EMPTY" | translate }}
                  </icc-checkbox>
                </icc-option>
              }
            </div>

            <ng-container
              *ngIf="
                selectOptions
                  | selectFilter: field.value : fieldConfig.optionLabel : fieldConfig.singleListOption as result
              "
            >
              <cdk-virtual-scroll-viewport
                class="icc-select-virtual-scroll"
                [itemSize]="28"
                (scrolledIndexChange)="onScrolledIndexChange($event)"
              >
                <icc-option
                  class="icc-select-field-option"
                  *cdkVirtualFor="let option of result"
                  [value]="option"
                  #ref
                  (click)="clickOption(ref)"
                >
                  @if (fieldConfig.multiSelection) {
                    <icc-checkbox [checked]="ref.selected">
                      <icc-filter-highlight [value]="getOptionLabel(option)" [filterValue]="filterValue">
                      </icc-filter-highlight>
                    </icc-checkbox>
                  } @else if (fieldConfig.singleListOption && fieldConfig.selectOnly) {
                    <ng-container>{{ option }}</ng-container>
                  } @else {
                    <icc-filter-highlight [value]="getOptionLabel(option)" [filterValue]="filterValue">
                    </icc-filter-highlight>
                  }
                </icc-option>
              </cdk-virtual-scroll-viewport>

              @if (!result.length) {
                <icc-option class="no-result">{{ "ICC.UI.LIST.NO_RESULT" | translate }}</icc-option>
              }
            </ng-container>
          </ng-template>
        </icc-autocomplete>
        -->
        @if (field && (field.touched || field.dirty) && field.errors) {
          <icc-form-field-errors>
            <icc-field-errors [errors]="field!.errors!"></icc-field-errors>
          </icc-form-field-errors>
        }
      </icc-form-field>
    </ng-container>
  </ng-container>
</ng-container>
